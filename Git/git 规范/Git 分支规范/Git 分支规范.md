----------------------------------------------
> *Made By Herolh*
----------------------------------------------

# Git分支规范 {#index}

[TOC]











# Git分支规范

## 版本号规范

语义化版本命名规范参考：https://semver.org/lang/zh-CN/

版本号是否符合规范检查器：https://jubianchi.github.io/semver-check/#/version/v1.0.0-alpha.beta





### 版本号组成

版本号主要由四部分组成：v1.0.0

- 第0个v为版本阶段
- 第1个数字2为主版本号
- 第2个数字1为次版本号
- 第3个数字3为修订版本号

完整版本号命名规则为:`版本阶段`、`主版本号`、`次版本号`、`修订版本号` = v1.2.3

何时增加主版本号、次版本号、修订版本号，没有特别的标准，主要由开发人员根据代码修改程度决定。以下可以用作参考：

- 主版本号(1)：当功能模块有较大的变动，比如增加多个模块或者整体架构发生变化。此版本号由项目决定是否修改。
- 子版本号(1)：当功能有一定的增加或变化，比如增加了对权限控制、增加自定义视图等功能。此版本号由项目决定是否修改。
- 阶段版本号(1)：一般是 Bug 修复或是一些小的变动，要经常发布修订版，时间间隔不限，修复一个严重的bug即可发布一个修订版。

在此基础上，还有可以有相关附加描述，参考先行版本号https://semver.org/lang/zh-CN/#spec-item-9



版本号大小比较，：

v1.0.0-alpha < v1.0.0-alpha.1 < v1.0.0-alpha.beta < v1.0.0-beta < v1.0.0-beta.2 < v1.0.0-beta.11 < v1.0.0-rc.1 < v1.0.0

版本号总体阶段：alpha(v1.0.1-alpha)，beta(v1.0.1-beta)，rc(v1.0.1-rc)，release(v1.0.1)

> alpha，beta，rc可忽略；
>
> release一定要有，为了提供非正式版本给外部测试，则可以考虑使用alpha版本，方便标记。



### 版本号总是递增的，无论哪个阶段



### 版本号发布流程变动情况参考
- **v1.0.0-alpha**          : alpha内部测试版本，尚不稳定
- **v1.0.0-alpha.1**       ：alpha内部测试版本，版本号递增
- **v1.0.0-alpha.beta** ： alpha内部测试版本的beta版本，考虑小范围外部测试
- **v1.0.0-beta**            ：beta外部测试版本
-  **v1.0.0-beta.2**        ： beta外部测试版本，版本号递增
-  **v1.0.0-beta.11**      ： beta外部测试版本，版本号递增 
- **v1.0.0-rc.1**              ：先行发布版本，用于线上测试环境
- **v1.0.0**                      ：release正式发布版本
一般也就 alpha 进行调整，beta 测试一下使用情况，然后准备发布release了



### 版本号生成点

- **v1.0.0-alpha.1**  : 内部测试版本号由项目version文件进行控制

- **v1.0.0-beta.1**    : 外部测试版本号由项目version文件进行控制

- **v1.0.0-rc.1**         : 先行发布版本号由标签进行生成控制

- **v1.0.0**                 : 正式发布版本号由标签进行生成控制



## Git开发分支规范

### 标准分支支持

- `feature` ：新功能开发。

  >  按命名规范扩展分支名。

- `bugfix` ：bug修复。

  > 按命名规范扩展分支名。

- `refactor` ：代码重构。

  > 按命名规范扩展分支名。

- `master` ：主分支，不可直接提交代码。**重点**。

  > 分支开发完成后，合并到该 `master` 分支，该分支应该是可靠，信任的。当多次合并完成后，根据规划进行版本发布，也就是打 `tag` 。分支的代码为上线正式使用版本，即版本阶段 `v` 。

- `test` ：测试分支，进行测试镜像打包等处理。**重点**。

  > 一般情况下，普通开发分支不进行镜像打包等消耗大的处理。需要生成镜像的，将开发分支合并到该分支进行处理即可。
  >
  > 后续考虑支持开发分支直接生成镜像的规范。

- `tag` ：标签，版本发布使用。**重点**。

  > 当master分支满足上线要求的版本时，通过生成tag，固化版本，如 `v1.0.1` 。




部分情况下，开发分支的规范并不一定能满足要求，但上述要求的重点项，强制要求。比如开发分支可以使用 `dev-feat-xxxx` 等。feat、fix、refactor等关键字一定要有。需要人名的，更推荐上面命名要求 `/xxx` 的。



### 流程

- master` 为保护分支，不直接在 `master` 上进行代码修改和提交。并且 master 分支永远保持是线上稳定版本的代码

- 从master分支checkout出一个开发分支，针对情况可以是：需求分支：feature-xxx 或者 bug分支：bugfix-xxx

    >  如果多人开发同一个分支或者其他情况需要分别开发者的，在分支名后面按格式补充 `/cjy` 等。
    >
    > 如 `feature-account-config/kws` 

- 开发完成开发工作后，将代码合并到 test 分支并生成测试版本镜像

- 测试通过后将代码**合并到 master 分支**，并**删除开发分支**

- 打 tag 生成线上测试环境镜像，准备进行线上测试环境更新

- 线上测试环境测试通过后，打 tag 生成正式发布版本号

- 准备进行线上生产环境更新工作